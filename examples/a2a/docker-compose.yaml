---
services:
  inference-gateway:
    image: ghcr.io/inference-gateway/inference-gateway:latest
    pull_policy: always
    environment:
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      CLOUDFLARE_API_KEY: ${CLOUDFLARE_API_KEY}
      COHERE_API_KEY: ${COHERE_API_KEY}
      GROQ_API_KEY: ${GROQ_API_KEY}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY}
      GOOGLE_API_KEY: ${GOOGLE_API_KEY}
      MISTRAL_API_KEY: ${MISTRAL_API_KEY}
      SERVER_READ_TIMEOUT: 230s
      SERVER_WRITE_TIMEOUT: 230s
      SERVER_IDLE_TIMEOUT: 230s
      CLIENT_TIMEOUT: 230s
    restart: unless-stopped
    networks:
      - a2a-network

  cli:
    profiles:
      - manual
    image: ghcr.io/inference-gateway/cli:latest
    pull_policy: always
    tty: true
    volumes:
      - ./downloads:/home/infer/.infer/tmp
    environment:
      INFER_GATEWAY_URL: http://inference-gateway:8080
      INFER_AGENT_MODEL: deepseek/deepseek-chat
      INFER_A2A_ENABLED: true
      INFER_A2A_AGENTS: |
        http://mock-agent:8080
        http://google-calendar-agent:8080
        http://n8n-agent:8080
        http://documentation-agent:8080
        http://browser-agent:8080
      INFER_TOOLS_WEB_FETCH_WHITELISTED_DOMAINS: |
        mock-agent
        google-calendar-agent
        n8n-agent
        documentation-agent
        browser-agent
        demo-site
    command:
      - chat
    networks:
      - a2a-network

  mock-agent:
    image: ghcr.io/inference-gateway/mock-agent:latest
    pull_policy: always
    environment:
      A2A_AGENT_URL: http://mock-agent:8080
      A2A_AGENT_CLIENT_PROVIDER: ""
      A2A_AGENT_CLIENT_MODEL: ""
      A2A_AGENT_CLIENT_BASE_URL: ""
      A2A_AGENT_CLIENT_TIMEOUT: 120s
      A2A_AGENT_CLIENT_TOOLS_CREATE_ARTIFACT: true
      A2A_SERVER_READ_TIMEOUT: 120s
      A2A_SERVER_WRITE_TIMEOUT: 120s
      A2A_SERVER_IDLE_TIMEOUT: 120s
      A2A_QUEUE_CLEANUP_INTERVAL: 500s
      A2A_ARTIFACTS_ENABLE: true
      A2A_ARTIFACTS_SERVER_HOST: localhost
      A2A_ARTIFACTS_SERVER_PORT: 8081
      A2A_ARTIFACTS_STORAGE_PROVIDER: filesystem
      A2A_ARTIFACTS_STORAGE_BASE_PATH: /tmp/artifacts
      A2A_ARTIFACTS_STORAGE_BASE_URL: http://mock-agent:8081
      A2A_ARTIFACTS_RETENTION_MAX_ARTIFACTS: 10
      A2A_ARTIFACTS_RETENTION_MAX_AGE: 24h
      A2A_ARTIFACTS_RETENTION_CLEANUP_INTERVAL: 24h
    restart: unless-stopped
    networks:
      - a2a-network

  google-calendar-agent:
    image: ghcr.io/inference-gateway/google-calendar-agent:latest
    pull_policy: always
    environment:
      A2A_AGENT_URL: http://google-calendar-agent:8080
      A2A_AGENT_CLIENT_PROVIDER: deepseek
      A2A_AGENT_CLIENT_MODEL: deepseek-chat
      A2A_AGENT_CLIENT_BASE_URL: http://inference-gateway:8080/v1
      A2A_AGENT_CLIENT_TIMEOUT: 120s
      A2A_SERVER_READ_TIMEOUT: 120s
      A2A_SERVER_WRITE_TIMEOUT: 120s
      A2A_SERVER_IDLE_TIMEOUT: 120s
      A2A_QUEUE_CLEANUP_INTERVAL: 500s
      GOOGLE_MOCK_MODE: false
      GOOGLE_CALENDAR_ID: ${GOOGLE_CALENDAR_ID}
      GOOGLE_CALENDAR_TIMEZONE: CET
      GOOGLE_SERVICE_ACCOUNT_JSON: ${GOOGLE_SERVICE_ACCOUNT_JSON}
      GOOGLE_APPLICATION_CREDENTIALS: /tmp/google-credentials.json
    restart: unless-stopped
    networks:
      - a2a-network

  documentation-agent:
    image: ghcr.io/inference-gateway/documentation-agent:latest
    pull_policy: always
    environment:
      A2A_AGENT_URL: http://documentation-agent:8080
      A2A_AGENT_CLIENT_PROVIDER: deepseek
      A2A_AGENT_CLIENT_MODEL: deepseek-chat
      A2A_AGENT_CLIENT_BASE_URL: http://inference-gateway:8080/v1
      A2A_AGENT_CLIENT_TIMEOUT: 120s
      A2A_SERVER_READ_TIMEOUT: 120s
      A2A_SERVER_WRITE_TIMEOUT: 120s
      A2A_SERVER_IDLE_TIMEOUT: 120s
      A2A_QUEUE_CLEANUP_INTERVAL: 500s
      CONTEXT7_API_KEY: ${CONTEXT7_API_KEY}
    restart: unless-stopped
    networks:
      - a2a-network

  n8n-agent:
    image: ghcr.io/inference-gateway/n8n-agent:latest
    pull_policy: always
    environment:
      A2A_AGENT_URL: http://n8n-agent:8080
      A2A_AGENT_CLIENT_PROVIDER: deepseek
      A2A_AGENT_CLIENT_MODEL: deepseek-chat
      A2A_AGENT_CLIENT_BASE_URL: http://inference-gateway:8080/v1
      A2A_AGENT_CLIENT_TOOLS_CREATE_ARTIFACT: true
      A2A_AGENT_CLIENT_TIMEOUT: 120s
      A2A_SERVER_READ_TIMEOUT: 120s
      A2A_SERVER_WRITE_TIMEOUT: 120s
      A2A_SERVER_IDLE_TIMEOUT: 120s
      A2A_QUEUE_CLEANUP_INTERVAL: 500s
      A2A_ARTIFACTS_ENABLE: true
      A2A_ARTIFACTS_SERVER_HOST: n8n-agent
      A2A_ARTIFACTS_SERVER_PORT: 8081
      A2A_ARTIFACTS_STORAGE_PROVIDER: filesystem
      A2A_ARTIFACTS_STORAGE_BASE_PATH: /tmp/artifacts
    volumes:
      - ./agents/n8n-agent:/tmp/artifacts
    restart: unless-stopped
    networks:
      - a2a-network

  browser-agent:
    image: ghcr.io/inference-gateway/browser-agent:latest
    pull_policy: always
    environment:
      BROWSER_DATA_DIR: /tmp/playwright
      BROWSER_HEADLESS: false
      BROWSER_XVFB_ENABLED: true
      BROWSER_XVFB_DISPLAY: ":99"
      BROWSER_XVFB_SCREEN_RESOLUTION: "1920x1080x24"
      BROWSER_XVFB_ALLOW_TCP: "true"
      A2A_AGENT_URL: http://browser-agent:8080
      A2A_AGENT_CLIENT_PROVIDER: deepseek
      A2A_AGENT_CLIENT_MODEL: deepseek-chat
      A2A_AGENT_CLIENT_BASE_URL: http://inference-gateway:8080/v1
      A2A_AGENT_CLIENT_TOOLS_CREATE_ARTIFACT: true
      A2A_AGENT_CLIENT_TIMEOUT: 120s
      A2A_SERVER_READ_TIMEOUT: 120s
      A2A_SERVER_WRITE_TIMEOUT: 120s
      A2A_SERVER_IDLE_TIMEOUT: 120s
      A2A_QUEUE_CLEANUP_INTERVAL: 500s
      A2A_ARTIFACTS_ENABLE: true
      A2A_ARTIFACTS_SERVER_HOST: localhost
      A2A_ARTIFACTS_SERVER_PORT: 8081
      A2A_ARTIFACTS_STORAGE_PROVIDER: filesystem
      A2A_ARTIFACTS_STORAGE_BASE_PATH: /tmp/artifacts
      A2A_ARTIFACTS_STORAGE_BASE_URL: http://browser-agent:8081
      A2A_ARTIFACTS_RETENTION_MAX_ARTIFACTS: 10
      A2A_ARTIFACTS_RETENTION_MAX_AGE: 24h
      A2A_ARTIFACTS_RETENTION_CLEANUP_INTERVAL: 24h
    volumes:
      - ./agents/browser-agent:/tmp/artifacts
    restart: unless-stopped
    networks:
      - a2a-network

  browser-vnc:
    build:
      context: .
      dockerfile: Dockerfile.vnc
    environment:
      X_HOST: browser-agent
      X_DISPLAY: 99
    ports:
      - "5900:5900"
    depends_on:
      - browser-agent
    restart: unless-stopped
    networks:
      - a2a-network

  demo-site:
    image: nginx:alpine
    volumes:
      - ./demo-site:/usr/share/nginx/html:ro
    networks:
      - a2a-network

  a2a-debugger:
    image: ghcr.io/inference-gateway/a2a-debugger:latest
    pull_policy: always
    entrypoint:
      - /a2a
      - --server-url
      - http://browser-agent:8080
    networks:
      - a2a-network
    profiles:
      - manual

networks:
  a2a-network:
    driver: bridge
